<!DOCTYPE html>
<html>
<head>
    <title>Move test</title>
    <script type="module">
        const canvasWidth = 12;
        const canvasHeight = 8;
        const squarWidth = 50;
        const squarHeight = 50;
        const imageURL = "skuggan.svg"

        window.startGame = function() {
            const canvas = document.getElementById("canvas");
            canvas.width = canvasWidth*squarWidth;
            canvas.height = canvasHeight*squarHeight;
            const rect = canvas.getBoundingClientRect();
            const canvasX = (rect.right-rect.left-canvas.width)/2+rect.left
            const canvasY = (rect.bottom-rect.top-canvas.height)/2+rect.top
            const context = canvas.getContext("2d");
            context.imageSmoothingEnabled = false;
            const img = new Image();
            img.onload = function() {
                update(0 , 0)
            }
            img.src = imageURL;
            let currentX
            let currentY

            const update = function(newX, newY){
                console.log('X: '+newX+' Y: '+newY)
                if (0 <= newX && newX < canvasWidth && 0 <= newY && newY < canvasHeight){     
                    context.clearRect(currentX*squarWidth, currentY*squarHeight, squarWidth, squarHeight);
                    context.drawImage(img, newX*squarWidth, newY*squarHeight, squarWidth, squarHeight);
                    currentX = newX
                    currentY = newY
                }
            }

            function HandleMoveEvent(e){
                const x = Math.round((e.pageX-canvasX)/squarWidth - 0.5)
                const y = Math.round((e.pageY-canvasY)/squarHeight - 0.5)
                update(x, y)
            }
            canvas.addEventListener('mousedown', HandleMoveEvent) // 'mouseup'
            canvas.addEventListener('touchstart', HandleMoveEvent) // 'touchend'
            window.addEventListener('keyup', (event) => {
                switch (event.key) {
                    case 'ArrowLeft':
                        update(currentX-1, currentY)
                        break;
                    case 'ArrowRight':
                        update(currentX+1, currentY)
                        break;
                    case 'ArrowUp':
                        update(currentX, currentY-1)
                        break;
                    case 'ArrowDown':
                        update(currentX, currentY+1)
                        break;
                    default:
                        alert("Only Arrow Keys Are Allowed!");
                }
            });
        }
    </script>
</head>
<body onload="startGame()">
    <canvas id="canvas" style="border:4px solid #000000;"></canvas>
    <p>Move Sommarskuggan with your finger, mouse or arrow keys.</p>
</body>
</html>