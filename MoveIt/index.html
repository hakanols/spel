<!DOCTYPE html>
<html>
<head>
    <title>Move test</title>
    <script type="module">
        const canvasWidth = 14;
        const canvasHeight = 8;
        const squarWidth = 100;
        const squarHeight = 100;
        const imageURL = "skuggan.svg"

        window.startGame = function() {
            const canvas = document.getElementById("canvas");
            canvas.width = canvasWidth*squarWidth;
            canvas.height = canvasHeight*squarHeight;

            const context = canvas.getContext("2d");
            context.imageSmoothingEnabled = false;
            const img = new Image();
            img.onload = function() {
                update(0 , 0)
            }
            img.src = imageURL;
            let currentX
            let currentY

            const update = function(newX, newY){
                console.log('X: '+newX+' Y: '+newY)
                if (0 <= newX && newX < canvasWidth && 0 <= newY && newY < canvasHeight){     
                    context.clearRect(currentX*squarWidth, currentY*squarHeight, squarWidth, squarHeight);
                    context.drawImage(img, newX*squarWidth, newY*squarHeight, squarWidth, squarHeight);
                    currentX = newX
                    currentY = newY
                }
            }

            function HandleMoveEvent(e){
                const rect = canvas.getBoundingClientRect();
                const canvasBoxWidth = (rect.right-rect.left)/canvasWidth
                const canvasBoxHeight = (rect.bottom-rect.top)/canvasHeight
                const x = Math.floor((e.pageX-rect.left)/canvasBoxWidth)
                const y = Math.floor((e.pageY-rect.top)/canvasBoxHeight)
                update(x, y)
            }
            canvas.addEventListener('mousedown', HandleMoveEvent) // 'mouseup'
            canvas.addEventListener('touchstart', HandleMoveEvent) // 'touchend'
            window.addEventListener('keyup', (event) => {
                switch (event.key) {
                    case 'ArrowLeft':
                        update(currentX-1, currentY)
                        break;
                    case 'ArrowRight':
                        update(currentX+1, currentY)
                        break;
                    case 'ArrowUp':
                        update(currentX, currentY-1)
                        break;
                    case 'ArrowDown':
                        update(currentX, currentY+1)
                        break;
                    default:
                        alert("Only Arrow Keys Are Allowed!");
                }
            });
        }
    </script>
</head>
<body onload="startGame()">
    <div style="width: 100vw; height: 66vw; 
    max-height: 100vh; max-width: 150vh; margin: auto;
    position: absolute; top:0;bottom:0; left:0;right:0;">
        <canvas id="canvas" style="width:100%; aspect-ratio:5/3;border:4px solid #000000;"></canvas>
        <p>Move Sommarskuggan with your finger, mouse or arrow keys.</p>
    </div>
</body>
</html>