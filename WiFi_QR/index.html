<html>
	<header>
		<title>WiFi QR code</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<script type="module">
			import * as QRCode from './qrcode-lite.js'
			
			const qrCodeElement = document.getElementById("qrcode");
			const ssidElement = document.getElementById("ssid");
			const passwordElement = document.getElementById("password");
			const urlElement = document.getElementById("url");		
			const wifiRadioElement = document.getElementById("radioWifi");
			const urlRadioElement = document.getElementById("radioUrl");

			const options = {
				errorCorrectionLevel: 'H'
			}

			function createWiFiMessage(ssid, password){
				const security = "WPA" // <WPA|WEP|>
				return "WIFI:S:"+ssid+";T:"+security+";P:"+password+";;";
			}

			async function setQRcode(content){
				qrCodeElement.innerHTML = "";
				await QRCode.toCanvas(qrCodeElement, content, options);
			}

			window.updateCount = async function(){
				let content
				if (wifiRadioElement.checked){
					content = createWiFiMessage(ssidElement.value, passwordElement.value)
				}
				else if (urlRadioElement.checked){
					content = urlElement.value
				}
				console.log(content)
				if (content == ""){
					qrCodeElement.innerHTML = "";
				}
				else {
					await setQRcode(content);
				}
			}

			window.updateCount();

		</script>
	</header>
	<body style="background-image: url('agave.jpg'); background-repeat: no-repeat; background-attachment: fixed; background-size: cover; background-position: center center;">
		
		<input type="radio" id="radioWifi" name="qrType" checked="checked" onclick="updateCount();">
		<p>SSID: <input type="text" size="80" id="ssid"  onclick="updateCount()"></p>
		<p>Password: <input type="text" size="80" id="password"  onclick="updateCount()"></p>

		<input type="radio" id="radioUrl" name="qrType" onclick="updateCount();">
		<p>Url or free text: <input type="text" size="80" id="url"  onclick="updateCount()"></p>

		<p>Scan QR-code to join WiFi network</p>
		<canvas  id="qrcode"></canvas >
	</body>
</html>
