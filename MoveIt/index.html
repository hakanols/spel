<!DOCTYPE html>
<html>
<head>
    <title>Move test</title>
    <script type="module">
        const canvasWidth = 500;
        const canvasHeight = 500;
        const squarWidth = 50;
        const squarHeight = 50;
        const imageURL = "skuggan.svg"

        window.startGame = function() {
            const canvas = document.getElementById("canvas");
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            const rect = canvas.getBoundingClientRect();
            const context = canvas.getContext("2d");
            context.imageSmoothingEnabled = false;
            const img = new Image();
            img.onload = function() {
                update(squarWidth/2 , squarHeight/2)
            }
            img.src = imageURL;
            let x
            let y

            const update = function(newX, newY){
                x = (Math.round(newX/squarWidth - 0.5) + 0.5)*squarWidth
                y = (Math.round(newY/squarHeight - 0.5) + 0.5)*squarHeight
                context.clearRect(0, 0, canvas.width, canvas.height);
                context.drawImage(img, x-squarWidth/2, y-squarHeight/2,squarWidth, squarHeight);
            }

            canvas.addEventListener('mousedown', function (e) { // 'mouseup'
                update(e.pageX-rect.left, e.pageY-rect.top)
            })
            canvas.addEventListener('touchstart', function (e) { // 'touchend'
                update(e.pageX-rect.left, e.pageY-rect.top)
            })
            window.addEventListener('keyup', (event) => {
                switch (event.key) {
                    case 'ArrowLeft':
                        update(x-squarWidth, y)
                        break;
                    case 'ArrowRight':
                        update(x+squarWidth, y)
                        break;
                    case 'ArrowUp':
                        update(x, y-squarHeight)
                        break;
                    case 'ArrowDown':
                        update(x, y+squarHeight)
                        break;
                    default:
                        alert("Only Arrow Keys Are Allowed!");
                }
            });
        }
    </script>
</head>
<body onload="startGame()">
    <canvas id="canvas" style="border:4px solid #000000;"></canvas>
    <p>Move Sommarskuggan with your finger, mouse or arrow keys.</p>
</body>
</html>