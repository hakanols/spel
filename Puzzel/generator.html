
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Generate Puzzel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script type="module">
        import QRCode from './qrcode.js'

        const message = document.getElementById('message');
        const link = document.getElementById('link');
        const printArea = document.getElementById('print_area');
        const qrOutput = document.getElementById('qr_image');
		const imgOutput = document.getElementById('img_image');


        window.onload = function(){
            message.value = "12"
            window.updateLink()
        }

        window.updateLink = function() {
            const content = createShowerUrl(message.value)
            link.href = content;
            let qrCode = new QRCode({ content: content, padding: 1, join: true});
            const blob = new Blob([qrCode.svg()], { type: "image/svg+xml" });
            qrOutput.src = URL.createObjectURL(blob);
        }
        
        window.showImage = async function(event) {
            const [imageBlob] = event.target.files
            imgOutput.src = URL.createObjectURL(imageBlob);
		}

        window.myPrint = function(){
            const printContents = printArea.innerHTML;
            const originalContents = document.body.innerHTML;

            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
        }

        function createShowerUrl(text){
                let currentLocation = location.protocol + '//' + location.host + location.pathname
                let url = currentLocation.replace("generator.html", "index.html")
                return url + '?D=' + text
            }
    </script>  
</head>
<body>
    <h2>Generate Puzzel</h2>
    <input style="width:500;" id="message" oninput="updateLink()" type="text"></input>
    <a id="link">(link)</a>
    <br>
    <input type="file" accept="image/*" onchange="showImage(event)"/>
    <br>
    <button onclick="myPrint()">Print</button>
    <br>

    <div id="print_area">
        <img id="img_image" width="500" height="500"/>
        <div style="break-after:page"></div>
        <img id="qr_image" width="500" height="500"/>
    </div>
</body>
</html>
